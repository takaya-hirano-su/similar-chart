{% load static %}

<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>Similar Chart</title>
    <!-- chartjs読み込み -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
</head>
<body>
    <h1>Similar Chart</h1>
    <table>
        <form action="{% url 'index' %}" method="post" name="mainform">
            {% csrf_token %}
            {{forms.as_table}}
        </form>
    </table>

    <canvas id="main-canvas">No chart...</canvas>

    <script src="{% static 'main/js/script.js' %}"></script>
    <script type="text/javascript">
        var datasets=[];
        var main_ctx="main-canvas";
        var main_canvas=false;

        var chart_data=JSON.parse('{{ chart|safe }}'); //formで選択したチャートデータ
        datasets.push({
            data:Object.values(chart_data["close"]),
            type:"line",
            fill:false,
            label:"target-chart",
            lineTension:0.0,
            borderColor:getColor(0,0.7),
            backgroundColor:getColor(0,0.7),
        })
        
        var similar_chart=JSON.parse('{{similar_chart|safe}}'); 
        // console.log(similar_chart);
        var similar_num=Object.keys(similar_chart).length; 
        
        for(var i=0; i<similar_num; i++){
            var values=Object.values(similar_chart["No"+String(i+1)]["scaled"]["close"]);
            var dates=Object.values(similar_chart["No"+String(i+1)]["scaled"]["date"]);
            var alpha=0.3/(i+1);

            datasets.push({
                data:values,
                type:"line",
                fill:false,
                label:"similar-chart:No"+String(i+1),
                lineTension:0.0,
                borderColor:getColor(i+1,alpha),
                backgroundColor:getColor(i+1,alpha),
            })
        }

        drawChart(main_ctx,main_canvas,dates,datasets);
    </script>

</body>
</html>